generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model notifications {
  notification_id BigInt    @id @default(autoincrement())
  user_id         String?   @db.Uuid
  title           String?   @db.VarChar(200)
  content         String?
  is_read         Boolean?  @default(false)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  users           users?    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
}

model payments {
  payment_id     BigInt          @id @default(autoincrement())
  reservation_id BigInt?         @unique
  amount         Decimal?        @db.Decimal(12, 2)
  method         payment_method?
  status         payment_status? @default(unpaid)
  paid_at        DateTime?       @db.Timestamptz(6)
  created_at     DateTime?       @default(now()) @db.Timestamptz(6)
  reservations   reservations?   @relation(fields: [reservation_id], references: [reservation_id], onDelete: Cascade, onUpdate: NoAction)
}

model reservation_tables {
  id             BigInt        @id @default(autoincrement())
  reservation_id BigInt?
  table_id       BigInt?
  reservations   reservations? @relation(fields: [reservation_id], references: [reservation_id], onDelete: Cascade, onUpdate: NoAction)
  tables         tables?       @relation(fields: [table_id], references: [table_id], onDelete: Cascade, onUpdate: NoAction)
}

model reservations {
  reservation_id     BigInt               @id @default(autoincrement())
  customer_name      String               @db.VarChar(150)
  customer_phone     String?              @db.VarChar(20)
  checkin_time       DateTime             @db.Timestamptz(6)
  checkout_time      DateTime?            @db.Timestamptz(6)
  number_of_people   Int
  status             reservation_status?  @default(pending)
  user_id            String?              @db.Uuid
  note               String?
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  payments           payments?
  reservation_tables reservation_tables[]
  users              users?               @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)
}

model tables {
  table_id           BigInt               @id @default(autoincrement())
  name               String               @db.VarChar(50)
  area               String?              @db.VarChar(50)
  capacity           Int
  status             table_status?        @default(available)
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  reservation_tables reservation_tables[]
}

model users {
  user_id       String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  full_name     String?         @db.VarChar(150)
  phone         String?         @db.VarChar(20)
  email         String?         @unique @db.VarChar(150)
  password_hash String?
  role          String?         @default("staff") @db.VarChar(20)
  created_at    DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?       @default(now()) @db.Timestamptz(6)
  notifications notifications[]
  reservations  reservations[]
}

enum payment_method {
  cash
  card
  transfer
  momo
  zalo
}

enum payment_status {
  unpaid
  paid
  refunded
}

enum reservation_status {
  pending
  confirmed
  cancelled
  completed
}

enum table_status {
  available
  reserved
  occupied
  disabled
}
